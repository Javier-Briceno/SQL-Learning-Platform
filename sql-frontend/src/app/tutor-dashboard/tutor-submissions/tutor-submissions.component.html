<div class="tutor-submissions">
  <div class="header">
    <h1>
      <mat-icon>assignment_turned_in</mat-icon>
      Abgaben verwalten
    </h1>
    <p>Übersicht über alle Abgaben Ihrer Übungsblätter</p>
    

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Lade Abgaben...</p>
  </div>

  <!-- Submissions Content -->
  <div *ngIf="!isLoading">
    
    <!-- Empty State -->
    <div *ngIf="submissions.length === 0" class="empty-state">
      <mat-icon>assignment_turned_in</mat-icon>
      <h3>Keine Abgaben vorhanden</h3>
      <p>Es sind noch keine Abgaben für Ihre Übungsblätter eingegangen.</p>
    </div>

    <!-- Submissions Tabs -->
    <mat-tab-group 
      *ngIf="submissions.length > 0"
      [(selectedIndex)]="selectedTabIndex" 
      (selectedTabChange)="onTabChange($event.index)"
      class="submissions-tabs">
      
      <!-- Alle Abgaben -->
      <mat-tab [label]="'Alle (' + allSubmissions.length + ')'">
        <div class="tab-content">
          <div class="submissions-table">
            <table mat-table [dataSource]="allSubmissions" class="submission-table">
              
              <!-- Student Column -->
              <ng-container matColumnDef="student">
                <th mat-header-cell *matHeaderCellDef>Student</th>
                <td mat-cell *matCellDef="let submission">
                  <div class="student-info">
                    <mat-icon>person</mat-icon>
                    <div>
                      <strong>{{ submission.student.name }}</strong>
                      <br>
                      <small>{{ submission.student.email }}</small>
                    </div>
                  </div>
                </td>
              </ng-container>

              <!-- Worksheet Column -->
              <ng-container matColumnDef="worksheet">
                <th mat-header-cell *matHeaderCellDef>Übungsblatt</th>
                <td mat-cell *matCellDef="let submission">
                  <div class="worksheet-info">
                    <strong>{{ submission.worksheet.title }}</strong>
                    <br>
                    <small>
                      <mat-icon class="small-icon">storage</mat-icon>
                      {{ submission.worksheet.database }}
                    </small>
                  </div>
                </td>
              </ng-container>

              <!-- Status Column -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let submission">
                  <mat-chip [color]="getSubmissionStatusColor(submission)" selected>
                    <mat-icon matChipAvatar>{{ getSubmissionStatusIcon(submission) }}</mat-icon>
                    {{ getSubmissionStatusText(submission) }}
                  </mat-chip>
                </td>
              </ng-container>

              <!-- Progress Column -->
              <ng-container matColumnDef="progress">
                <th mat-header-cell *matHeaderCellDef>Fortschritt</th>
                <td mat-cell *matCellDef="let submission">
                  <div class="progress-info">
                    <mat-chip [color]="getProgressColor(getProgressPercentage(submission))" selected>
                      {{ submission._count.answers }} / {{ submission.worksheet._count.tasks }}
                      ({{ getProgressPercentage(submission) }}%)
                    </mat-chip>
                  </div>
                </td>
              </ng-container>

              <!-- Date Column -->
              <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef>Datum</th>
                <td mat-cell *matCellDef="let submission">
                  <div class="date-info">
                    <strong *ngIf="submission.status === 'SUBMITTED'">
                      {{ formatDate(submission.submittedAt!) }}
                    </strong>
                    <span *ngIf="submission.status === 'DRAFT'">
                      {{ formatDate(submission.updatedAt) }}
                    </span>
                    <br>
                    <small>
                      {{ submission.status === 'SUBMITTED' ? 'Abgegeben' : 'Zuletzt bearbeitet' }}
                    </small>
                  </div>
                </td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Aktionen</th>
                <td mat-cell *matCellDef="let submission">
                  <button 
                    mat-stroked-button 
                    color="primary"
                    (click)="viewSubmission(submission)">
                    <mat-icon>visibility</mat-icon>
                    Ansehen
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
          </div>
        </div>
      </mat-tab>      <!-- Abgegebene Submissions -->
      <mat-tab [label]="'Abgegeben (' + submittedSubmissions.length + ')'">
        <div class="tab-content">
          <div class="submissions-table">
            <table mat-table [dataSource]="submittedSubmissions" class="submission-table">
              
              <!-- Student Column -->
              <ng-container matColumnDef="student">
                <th mat-header-cell *matHeaderCellDef>Student</th>
                <td mat-cell *matCellDef="let submission">
                  <div class="student-info">
                    <mat-icon>person</mat-icon>
                    <div>
                      <strong>{{ submission.student.name }}</strong>
                      <br>
                      <small>{{ submission.student.email }}</small>
                    </div>
                  </div>
                </td>
              </ng-container>

              <!-- Worksheet Column -->
              <ng-container matColumnDef="worksheet">
                <th mat-header-cell *matHeaderCellDef>Übungsblatt</th>
                <td mat-cell *matCellDef="let submission">
                  <div class="worksheet-info">
                    <strong>{{ submission.worksheet.title }}</strong>
                    <br>
                    <small>
                      <mat-icon class="small-icon">storage</mat-icon>
                      {{ submission.worksheet.database }}
                    </small>
                  </div>
                </td>
              </ng-container>

              <!-- Status Column -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let submission">
                  <mat-chip [color]="getSubmissionStatusColor(submission)" selected>
                    <mat-icon matChipAvatar>{{ getSubmissionStatusIcon(submission) }}</mat-icon>
                    {{ getSubmissionStatusText(submission) }}
                  </mat-chip>
                </td>
              </ng-container>

              <!-- Progress Column -->
              <ng-container matColumnDef="progress">
                <th mat-header-cell *matHeaderCellDef>Fortschritt</th>
                <td mat-cell *matCellDef="let submission">
                  <div class="progress-info">
                    <mat-chip [color]="getProgressColor(getProgressPercentage(submission))" selected>
                      {{ submission._count.answers }} / {{ submission.worksheet._count.tasks }}
                      ({{ getProgressPercentage(submission) }}%)
                    </mat-chip>
                  </div>
                </td>
              </ng-container>

              <!-- Date Column -->
              <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef>Datum</th>
                <td mat-cell *matCellDef="let submission">
                  <div class="date-info">
                    <strong *ngIf="submission.status === 'SUBMITTED'">
                      {{ formatDate(submission.submittedAt!) }}
                    </strong>
                    <span *ngIf="submission.status === 'DRAFT'">
                      {{ formatDate(submission.updatedAt) }}
                    </span>
                    <br>
                    <small>
                      {{ submission.status === 'SUBMITTED' ? 'Abgegeben' : 'Zuletzt bearbeitet' }}
                    </small>
                  </div>
                </td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Aktionen</th>
                <td mat-cell *matCellDef="let submission">
                  <button 
                    mat-stroked-button 
                    color="primary"
                    (click)="viewSubmission(submission)">
                    <mat-icon>visibility</mat-icon>
                    Ansehen
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
          </div>
        </div>
      </mat-tab>      <!-- Draft Submissions -->
      <mat-tab [label]="'In Bearbeitung (' + draftSubmissions.length + ')'">
        <div class="tab-content">
          <div class="submissions-table">
            <table mat-table [dataSource]="draftSubmissions" class="submission-table">
              
              <!-- Student Column -->
              <ng-container matColumnDef="student">
                <th mat-header-cell *matHeaderCellDef>Student</th>
                <td mat-cell *matCellDef="let submission">
                  <div class="student-info">
                    <mat-icon>person</mat-icon>
                    <div>
                      <strong>{{ submission.student.name }}</strong>
                      <br>
                      <small>{{ submission.student.email }}</small>
                    </div>
                  </div>
                </td>
              </ng-container>

              <!-- Worksheet Column -->
              <ng-container matColumnDef="worksheet">
                <th mat-header-cell *matHeaderCellDef>Übungsblatt</th>
                <td mat-cell *matCellDef="let submission">
                  <div class="worksheet-info">
                    <strong>{{ submission.worksheet.title }}</strong>
                    <br>
                    <small>
                      <mat-icon class="small-icon">storage</mat-icon>
                      {{ submission.worksheet.database }}
                    </small>
                  </div>
                </td>
              </ng-container>

              <!-- Status Column -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let submission">
                  <mat-chip [color]="getSubmissionStatusColor(submission)" selected>
                    <mat-icon matChipAvatar>{{ getSubmissionStatusIcon(submission) }}</mat-icon>
                    {{ getSubmissionStatusText(submission) }}
                  </mat-chip>
                </td>
              </ng-container>

              <!-- Progress Column -->
              <ng-container matColumnDef="progress">
                <th mat-header-cell *matHeaderCellDef>Fortschritt</th>
                <td mat-cell *matCellDef="let submission">
                  <div class="progress-info">
                    <mat-chip [color]="getProgressColor(getProgressPercentage(submission))" selected>
                      {{ submission._count.answers }} / {{ submission.worksheet._count.tasks }}
                      ({{ getProgressPercentage(submission) }}%)
                    </mat-chip>
                  </div>
                </td>
              </ng-container>

              <!-- Date Column -->
              <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef>Datum</th>
                <td mat-cell *matCellDef="let submission">
                  <div class="date-info">
                    <strong *ngIf="submission.status === 'SUBMITTED'">
                      {{ formatDate(submission.submittedAt!) }}
                    </strong>
                    <span *ngIf="submission.status === 'DRAFT'">
                      {{ formatDate(submission.updatedAt) }}
                    </span>
                    <br>
                    <small>
                      {{ submission.status === 'SUBMITTED' ? 'Abgegeben' : 'Zuletzt bearbeitet' }}
                    </small>
                  </div>
                </td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Aktionen</th>
                <td mat-cell *matCellDef="let submission">
                  <button 
                    mat-stroked-button 
                    color="primary"
                    (click)="viewSubmission(submission)">
                    <mat-icon>visibility</mat-icon>
                    Ansehen
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>
